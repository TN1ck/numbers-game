"use strict";!function(){var a=function(a){return{y:Math.floor(a/9),x:a%9}},b=function(a,b){return 9*b+a},c=function(a,b){this.v=a,this.board=b;var c=this.to_xy();this.y=c.y,this.x=c.x,this.neighbours={above:!1,below:!1,right:!1,left:!1},this.set_neighbours(),this.active=!0,b.tiles.push(this)};c.prototype.to_xy=function(){return a(this.board.tiles.length)},c.prototype.to_index=function(){return b(this.x,this.y)},c.prototype.activate=function(){this.dom.bind("touchstart click",this.listener)},c.prototype.deactivate=function(){this.active=!1,this.dom.unbind("touchstart click")},c.prototype.check_match=function(a){return a.v+this.v===10||a.v===this.v},c.prototype.set_above=function(){for(var a=this.x,b=this.y-1,c=!0;c&&!c.active;)c=this.board.get_tile(a,b),b--;c?(this.neighbours.above=c,c.neighbours.below=this):this.neighbours.above=!1},c.prototype.set_below=function(){for(var a=this.x,b=this.y+1,c=!0;c&&!c.active;)c=this.board.get_tile(a,b),b++;c?(this.neighbours.below=c,c.neighbours.above=this):this.neighbours.below=!1},c.prototype.set_right=function(){for(var a=this.to_index()+1,b=!0;b&&!b.active;)b=this.board.tiles[a],a++;b?(this.neighbours.right=b,b.neighbours.left=this):this.neighbours.right=!1},c.prototype.set_left=function(){for(var a=this.to_index()-1,b=!0;b&&!b.active;)b=this.board.tiles[a],a--;b?(this.neighbours.left=b,b.neighbours.right=this):this.neighbours.left=!1},c.prototype.set_neighbours=function(){this.set_above(),this.set_below(),this.set_right(),this.set_left()},c.prototype.get_neighbours=function(){var a=[this.neighbours.above,this.neighbours.below,this.neighbours.left,this.neighbours.right];return a.filter(function(a){return a&&a.active})};var d=function(a){var d=this;this.columns=a,this.tiles=[],this.get_tile=function(a,c){return d.tiles[b(a,c)]},d.init=function(){_.each([0,1],function(a){_.each(_.range(d.columns),function(b){var e=""+(10*a+b+1);_.each(_.range(e.length),function(a){new c(Number(e[a]),d)})})})},d.update=function(){var a=d.tiles.filter(_.property("active"));0===a.length&&window.alert("You won the game! Congrats!"),_.each(a,function(a){new c(a.v,d)})},d.left_matches=function(){var a=[];return _.each(d.tiles.filter(_.property("active")),function(b){var c=b.get_neighbours().filter(function(a){return b.check_match(a)});a=a.concat(c)}),a},d.init()},e=function(a){var b=this;this.board=new d(9),this.root=a;var c=$("#score_number"),e=$("#new_game"),f=0;this.draw_tile=function(a,d){var e=$("<td></td>"),g=$("<div></div>");e.append(g),a.append(e),g.addClass("tile").html(d.v),d.active||g.addClass("tile__matched");var h=function(){var a=$(this);if(a.hasClass("tile__good_match"))return f++,c.html(f),$(b.currently_selected.dom[0]).addClass("tile__matched"),a.addClass("tile__matched"),d.deactivate(),b.currently_selected.deactivate(),_.each(b.board.tiles,function(a){a.set_neighbours()}),$(".tile").removeClass("tile__hint tile__selected tile__good_match tile__bad_match"),void b.draw_hint();$(".tile").removeClass("tile__hint tile__selected tile__good_match tile__bad_match"),a.addClass("tile__selected");var e=d.get_neighbours();_.each(e,function(a){var b=d.check_match(a);a.dom.addClass(b?"tile__good_match":"tile__bad_match")}),b.currently_selected=d,b.draw_hint()},i=!1,j=function(){return i||(i=!0,setTimeout(function(){i=!1},200),h.bind(this)()),!1};d.dom=g,d.listener=j},this.draw_board=function(){b.root.html("");var a=$("<table></table>");b.root.append(a);var c;_.each(b.board.tiles,function(d,e){if(e%9===0){var f=$("<tr></tr>").addClass("tile_row");a.append(f),c=f}b.draw_tile(c,d)})},this.draw_hint=function(){var a=b.board.left_matches();_.each(a,function(a){a.activate(),a.dom.addClass("tile__hint")}),0===a.length&&(b.board.update(),b.draw_board(),b.draw_hint())},this.run=function(){this.board=new d(9),this.draw_board(),this.draw_hint()},this.restart=function(){c.html(0),f=0,b.run()},e.bind("click",this.restart)},f=$("#game"),g=new e(f);g.run()}();